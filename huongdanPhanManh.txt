================================================================================
 HÆ¯á»šNG DáºªN PHÃ‚N Máº¢NH Dá»® LIá»†U Báº°NG SQL SERVER REPLICATION
 Dá»± Ã¡n: Há»‡ Thá»‘ng Quáº£n LÃ½ Äá»™i BÃ³ng - CSDL PhÃ¢n TÃ¡n
================================================================================

ğŸ“‹ Má»¤C Lá»¤C
    1. Tá»•ng quan vá» SQL Server Replication
    2. Cáº¥u hÃ¬nh 3 SQL Server Instances
    3. Thiáº¿t láº­p Publisher (Instance gá»‘c)
    4. Táº¡o Publications vá»›i Horizontal Filter
    5. Thiáº¿t láº­p Subscribers (2 máº£nh)
    6. Táº¡o Subscriptions
    7. Äá»“ng bá»™ vÃ  Monitoring
    8. Troubleshooting

================================================================================
1. Tá»”NG QUAN Vá»€ SQL SERVER REPLICATION
================================================================================

ğŸ¯ REPLICATION LÃ€ GÃŒ?
    SQL Server Replication lÃ  cÆ¡ cháº¿ tá»± Ä‘á»™ng sao chÃ©p vÃ  phÃ¢n phá»‘i dá»¯ liá»‡u
    tá»« 1 database (Publisher) Ä‘áº¿n nhiá»u databases khÃ¡c (Subscribers).

ğŸ“Š MÃ” HÃŒNH REPLICATION TRONG Dá»° ÃN:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             PUBLISHER (Winter - Instance gá»‘c)            â”‚
    â”‚         QL_BongDa - Global Schema (ToÃ n bá»™ dá»¯ liá»‡u)      â”‚
    â”‚    DoiBong | CauThu | TranDau | ThamGia (44 CT, 6 TD)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   PUBLICATION 1     â”‚   â”‚  PUBLICATION 2  â”‚
          â”‚   (CLB1 + SD1)      â”‚   â”‚  (CLB2 + SD2)   â”‚
          â”‚   â€¢ Filter: CLB1    â”‚   â”‚  â€¢ Filter: CLB2 â”‚
          â”‚   â€¢ Filter: SD1     â”‚   â”‚  â€¢ Filter: SD2  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                 â”‚
                     â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ SUBSCRIBER 1 (NGH1)    â”‚   â”‚ SUBSCRIBER 2 (NGH2)    â”‚
    â”‚ QL_BongDa_CLB1_SD1     â”‚   â”‚ QL_BongDa_CLB2_SD2     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ DoiBong: 2 Ä‘á»™i (CLB1)  â”‚   â”‚ DoiBong: 2 Ä‘á»™i (CLB2)  â”‚
    â”‚ CauThu: 22 CT          â”‚   â”‚ CauThu: 22 CT          â”‚
    â”‚ TranDau: 3 tráº­n (SD1)  â”‚   â”‚ TranDau: 3 tráº­n (SD2)  â”‚
    â”‚ ThamGia: 12 records    â”‚   â”‚ ThamGia: 12 records    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”„ LOáº I REPLICATION Sá»¬ Dá»¤NG:
    âœ… Transactional Replication with Horizontal Filtering
    
    LÃ½ do chá»n:
    - Äá»“ng bá»™ real-time (gáº§n nhÆ° tá»©c thÃ¬)
    - Publisher thá»±c hiá»‡n INSERT â†’ Tá»± Ä‘á»™ng nháº£y sang Subscriber Ä‘Ãºng
    - Há»— trá»£ filtering theo WHERE clause (CLB = 'CLB1', SanDau = 'SD1')
    - PhÃ¹ há»£p á»©ng dá»¥ng CRUD nhiá»u

ğŸ¯ HORIZONTAL FILTERING (Lá»c ngang):
    - Má»—i Publication chá»‰ chá»n Má»˜T PHáº¦N ROWS theo Ä‘iá»u kiá»‡n
    - VÃ­ dá»¥: Publication 1 chá»‰ láº¥y DoiBong WHERE CLB = 'CLB1'
    - Subscriber 1 chá»‰ nháº­n dá»¯ liá»‡u CLB1, KHÃ”NG nháº­n CLB2

================================================================================
2. Cáº¤U HÃŒNH 3 SQL SERVER INSTANCES
================================================================================

ğŸ“‹ YÃŠU Cáº¦U Há»† THá»NG:
    âœ“ SQL Server 2019+ (Developer/Standard/Enterprise Edition)
    âœ“ âš ï¸ SQL Server Agent pháº£i RUNNING trÃªn cáº£ 3 instances (Báº®T BUá»˜C!)
    âœ“ TCP/IP Protocol enabled
    âœ“ SQL Server Browser service Ä‘ang cháº¡y
    âœ“ Mixed Authentication Mode (SQL + Windows)
    âœ“ Firewall cho phÃ©p káº¿t ná»‘i giá»¯a cÃ¡c instances

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSTANCE 1: PUBLISHER - Winter (Instance gá»‘c)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Server Name:     Winter                                                 â”‚
â”‚ Instance Type:   Default Instance                                       â”‚
â”‚ Database:        QL_BongDa (Global Schema - ToÃ n bá»™)                   â”‚
â”‚ Role:            Publisher + Distributor                                â”‚
â”‚ âš ï¸ SQL Agent:    Báº®T BUá»˜C RUNNING (Snapshot + Distribution Agent)       â”‚
â”‚ Port:            1433 (default)                                         â”‚
â”‚ Login:           sa / 123456                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSTANCE 2: SUBSCRIBER 1 - localhost\NGH1                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Server Name:     localhost\NGH1                                         â”‚
â”‚ Instance Type:   Named Instance                                         â”‚
â”‚ Database:        QL_BongDa_CLB1_SD1 (Máº£nh CLB1 + SD1)                  â”‚
â”‚ Role:            Subscriber (Push Subscription)                         â”‚
â”‚ âš ï¸ SQL Agent:    Báº®T BUá»˜C RUNNING                                        â”‚
â”‚ Port:            Dynamic (check Configuration Manager)                  â”‚
â”‚ Login:           sa / 123456                                            â”‚
â”‚ Dá»¯ liá»‡u:         2 Ä‘á»™i (DB01, DB02), 22 cáº§u thá»§, 3 tráº­n               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSTANCE 3: SUBSCRIBER 2 - localhost\NGH2                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Server Name:     localhost\NGH2                                         â”‚
â”‚ Instance Type:   Named Instance                                         â”‚
â”‚ Database:        QL_BongDa_CLB2_SD2 (Máº£nh CLB2 + SD2)                  â”‚
â”‚ Role:            Subscriber (Push Subscription)                         â”‚
â”‚ âš ï¸ SQL Agent:    Báº®T BUá»˜C RUNNING                                        â”‚
â”‚ Port:            Dynamic (check Configuration Manager)                  â”‚
â”‚ Login:           sa / 123456                                            â”‚
â”‚ Dá»¯ liá»‡u:         2 Ä‘á»™i (DB03, DB04), 22 cáº§u thá»§, 3 tráº­n               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ QUAN TRá»ŒNG - KIá»‚M TRA SQL SERVER AGENT:

    1. Má»Ÿ SQL Server Configuration Manager
    2. SQL Server Services â†’ Kiá»ƒm tra 3 services:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ âœ… SQL Server Agent (MSSQLSERVER)    - Running  â”‚ â† Winter
       â”‚ âœ… SQL Server Agent (NGH1)            - Running  â”‚ â† NGH1
       â”‚ âœ… SQL Server Agent (NGH2)            - Running  â”‚ â† NGH2
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    3. Náº¿u Stopped â†’ Click pháº£i â†’ Start
    4. Click pháº£i â†’ Properties â†’ Service â†’ Start Mode: Automatic

================================================================================
3. THIáº¾T Láº¬P PUBLISHER (Winter - Instance gá»‘c)
================================================================================

ğŸ“ BÆ¯á»šC 1: Táº O DATABASE VÃ€ Dá»® LIá»†U TRÃŠN PUBLISHER

-- Káº¿t ná»‘i vÃ o Winter trong SSMS
USE master;
GO

-- Táº¡o database
CREATE DATABASE QL_BongDa;
GO

USE QL_BongDa;
GO

-- Táº¡o 4 báº£ng (schema Ä‘áº§y Ä‘á»§ trong file QlDoiBong.sql)
CREATE TABLE DoiBong (...);
CREATE TABLE CauThu (...);
CREATE TABLE TranDau (...);
CREATE TABLE ThamGia (...);
GO

-- Insert dá»¯ liá»‡u máº«u: 4 Ä‘á»™i, 44 cáº§u thá»§, 6 tráº­n, 24 records ThamGia
INSERT INTO DoiBong VALUES
    ('DB01', N'Manchester City', N'CLB1'),
    ('DB02', N'Arsenal', N'CLB1'),
    ('DB03', N'Real Madrid', N'CLB2'),
    ('DB04', N'Barcelona', N'CLB2');
-- (Insert Ä‘áº§y Ä‘á»§ xem file QlDoiBong.sql)
GO

ğŸ“ BÆ¯á»šC 2: Cáº¤U HÃŒNH DISTRIBUTOR (TrÃªn Winter)

âš ï¸ QUAN TRá»ŒNG: Distributor lÃ  thÃ nh pháº§n quáº£n lÃ½ Snapshot vÃ  Ä‘á»“ng bá»™!

-- CÃCH 1: DÃ¹ng GUI (Khuyáº¿n nghá»‹ cho ngÆ°á»i má»›i) --

    1. Má»Ÿ SSMS â†’ Connect Ä‘áº¿n Winter
    
    2. Expand "Replication" folder (náº¿u khÃ´ng tháº¥y, refresh láº¡i)
    
    3. Click pháº£i "Replication" â†’ "Configure Distribution..."
    
    4. Wizard xuáº¥t hiá»‡n â†’ Next
    
    5. Distributor:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ â¦¿ 'Winter' will act as its own Distributor   â”‚ â† CHá»ŒN CÃI NÃ€Y
       â”‚   SQL Server will create a distribution       â”‚
       â”‚   database and log                            â”‚
       â”‚                                               â”‚
       â”‚ âšª Use the following server as the            â”‚
       â”‚   Distributor (remote)                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    6. Snapshot Folder:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Default: C:\Program Files\Microsoft SQL       â”‚
       â”‚ Server\MSSQL15.MSSQLSERVER\MSSQL\ReplData     â”‚
       â”‚                                               â”‚
       â”‚ âš ï¸ LÆ°u Ã½: Folder nÃ y pháº£i cÃ³ quyá»n truy cáº­p   â”‚
       â”‚ cho SQL Server Agent service account!         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       
       â†’ Giá»¯ máº·c Ä‘á»‹nh hoáº·c chá»n thÆ° má»¥c khÃ¡c
    
    7. Distribution Database Name:
       â†’ Äá»ƒ máº·c Ä‘á»‹nh: "distribution"
    
    8. Publishers:
       â˜‘ Winter â† Check Ä‘á»ƒ enable
    
    9. Finish â†’ Chá» 10-20s â†’ "Successfully configured"
    
    10. Verify: Expand "Replication" â†’ Tháº¥y "Local Publications"

-- CÃCH 2: DÃ¹ng T-SQL --

USE master;
GO

EXEC sp_adddistributor 
    @distributor = N'Winter',
    @password = N'';  -- Empty cho local distributor
GO

EXEC sp_adddistributiondb 
    @database = N'distribution',
    @security_mode = 1;
GO

EXEC sp_adddistpublisher 
    @publisher = N'Winter',
    @distribution_db = N'distribution',
    @working_directory = N'C:\Program Files\Microsoft SQL Server\MSSQL15.MSSQLSERVER\MSSQL\ReplData';
GO

================================================================================
4. Táº O PUBLICATION 1 - CLB1 + SD1 (Cho Subscriber NGH1)
================================================================================

ğŸ“ BÆ¯á»šC 1: Táº O PUBLICATION Vá»šI NEW PUBLICATION WIZARD

    1. Trong SSMS (káº¿t ná»‘i Winter)
    
    2. Expand "Replication" â†’ "Local Publications"
    
    3. Click pháº£i "Local Publications" â†’ "New Publication..."
    
    4. New Publication Wizard:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 1: Publication Database                                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Select database:  QL_BongDa                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 2: Publication Type                                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ âšª Snapshot publication                                      â”‚
    â”‚ â¦¿ Transactional publication    â† CHá»ŒN CÃI NÃ€Y              â”‚
    â”‚ âšª Merge publication                                         â”‚
    â”‚                                                             â”‚
    â”‚ â˜‘ Updatable Subscriptions (optional - khÃ´ng cáº§n)           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 3: Articles (Chá»n báº£ng nÃ o sáº½ Ä‘Æ°á»£c replicate)         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Tables:                                                     â”‚
    â”‚   â˜‘ [dbo].[DoiBong]                                         â”‚
    â”‚   â˜‘ [dbo].[CauThu]                                          â”‚
    â”‚   â˜‘ [dbo].[TranDau]                                         â”‚
    â”‚   â˜‘ [dbo].[ThamGia]                                         â”‚
    â”‚                                                             â”‚
    â”‚ (Bá» check cÃ¡c object khÃ¡c nhÆ° Stored Proc, Views...)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ BÆ¯á»šC 2: âš ï¸ THIáº¾T Láº¬P HORIZONTAL FILTER (QUAN TRá»ŒNG NHáº¤T!)

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 4: Filter Table Rows                                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Click "Add" â†’ "Add Filter"                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    ğŸ”¹ FILTER 1: DoiBong (Chá»‰ láº¥y CLB1)
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Filter Name:        DoiBong_CLB1                          â”‚
    â”‚ Table to filter:    [dbo].[DoiBong]                       â”‚
    â”‚                                                           â”‚
    â”‚ Filter Statement:                                         â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ SELECT <published_columns> FROM [dbo].[DoiBong]     â”‚ â”‚
    â”‚ â”‚ WHERE                                                â”‚ â”‚
    â”‚ â”‚ [CLB] = 'CLB1'           â† ÄIá»€U KIá»†N Lá»ŒC            â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                           â”‚
    â”‚ â˜‘ A row in this table will go to only one subscription   â”‚
    â”‚   (Partition data - Ä‘Ãºng cho horizontal fragmentation)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Click OK
    
    ğŸ”¹ FILTER 2: CauThu (JOIN vá»›i DoiBong Ä‘á»ƒ láº¥y cáº§u thá»§ cá»§a CLB1)
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Click "Add" â†’ "Extend the existing filter"               â”‚
    â”‚                                                           â”‚
    â”‚ Base Article:       [dbo].[DoiBong]  (Ä‘Ã£ filter)         â”‚
    â”‚ Filtered table:     [dbo].[CauThu]                        â”‚
    â”‚                                                           â”‚
    â”‚ Join Statement:                                           â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ [dbo].[CauThu].[MaDB] = [dbo].[DoiBong].[MaDB]      â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                           â”‚
    â”‚ â¦¿ This is a JOIN          â† CHá»ŒN                         â”‚
    â”‚ âšª This is a logical record                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â†’ Káº¿t quáº£: CauThu sáº½ tá»± Ä‘á»™ng chá»‰ láº¥y cáº§u thá»§ cÃ³ MaDB thuá»™c CLB1
    
    Click OK
    
    ğŸ”¹ FILTER 3: TranDau (Chá»‰ láº¥y tráº­n táº¡i SD1)
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Click "Add" â†’ "Add Filter"  (Filter Ä‘á»™c láº­p)             â”‚
    â”‚                                                           â”‚
    â”‚ Filter Name:        TranDau_SD1                           â”‚
    â”‚ Table to filter:    [dbo].[TranDau]                       â”‚
    â”‚                                                           â”‚
    â”‚ Filter Statement:                                         â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ SELECT <published_columns> FROM [dbo].[TranDau]     â”‚ â”‚
    â”‚ â”‚ WHERE                                                â”‚ â”‚
    â”‚ â”‚ [SanDau] = 'SD1'         â† ÄIá»€U KIá»†N Lá»ŒC            â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                           â”‚
    â”‚ â˜‘ A row in this table will go to only one subscription   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Click OK
    
    ğŸ”¹ FILTER 4: ThamGia (JOIN vá»›i TranDau Ä‘á»ƒ láº¥y tham gia cá»§a SD1)
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Click "Add" â†’ "Extend the existing filter"               â”‚
    â”‚                                                           â”‚
    â”‚ Base Article:       [dbo].[TranDau]  (Ä‘Ã£ filter)         â”‚
    â”‚ Filtered table:     [dbo].[ThamGia]                       â”‚
    â”‚                                                           â”‚
    â”‚ Join Statement:                                           â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ â”‚ [dbo].[ThamGia].[MaTD] = [dbo].[TranDau].[MaTD]    â”‚ â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚                                                           â”‚
    â”‚ â¦¿ This is a JOIN          â† CHá»ŒN                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Click OK

ğŸ“ BÆ¯á»šC 3: Cáº¤U HÃŒNH SNAPSHOT AGENT

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 5: Snapshot Agent                                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â˜‘ Create a snapshot immediately                             â”‚
    â”‚ â˜‘ Schedule the Snapshot Agent to run at times:             â”‚
    â”‚   Daily at 12:00:00 AM  (hoáº·c tÃ¹y chá»‰nh)                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ BÆ¯á»šC 4: AGENT SECURITY

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 6: Agent Security                                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Click "Security Settings..."                                â”‚
    â”‚                                                             â”‚
    â”‚ Snapshot Agent:                                             â”‚
    â”‚ â¦¿ Run under the SQL Server Agent service account           â”‚
    â”‚ âšª Run under the following Windows account                  â”‚
    â”‚                                                             â”‚
    â”‚ Connect to the Publisher:                                   â”‚
    â”‚ â¦¿ Using the agent process account                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ BÆ¯á»šC 5: Äáº¶T TÃŠN PUBLICATION

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 7: Complete the Wizard                                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Publication name:  Pub_CLB1_SD1      â† TÃŠN PUBLICATION      â”‚
    â”‚                                                             â”‚
    â”‚ â˜‘ Create the publication                                    â”‚
    â”‚ â˜ Generate a script file with steps to create publication  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Click "Finish" â†’ Chá» 20-30s
    
    âœ… Káº¿t quáº£: "Successfully created publication 'Pub_CLB1_SD1'"
    
    âš ï¸ Snapshot sáº½ tá»± Ä‘á»™ng cháº¡y ngay sau khi táº¡o xong!

================================================================================
5. Táº O PUBLICATION 2 - CLB2 + SD2 (Cho Subscriber NGH2)
================================================================================

ğŸ“ LÃ€M TÆ¯Æ NG Tá»° NHÆ¯ PUBLICATION 1, NHÆ¯NG:

    Publication name:   Pub_CLB2_SD2
    
    Filter 1 - DoiBong: WHERE [CLB] = 'CLB2'     â† KhÃ¡c Publication 1
    Filter 2 - CauThu:  JOIN vá»›i DoiBong (tá»± Ä‘á»™ng láº¥y CLB2)
    Filter 3 - TranDau: WHERE [SanDau] = 'SD2'   â† KhÃ¡c Publication 1
    Filter 4 - ThamGia: JOIN vá»›i TranDau (tá»± Ä‘á»™ng láº¥y SD2)

âœ… Káº¾T QUáº¢: CÃ³ 2 Publications trÃªn Winter

    Expand "Replication" â†’ "Local Publications"
    â”œâ”€ Pub_CLB1_SD1  (4 articles: DoiBong, CauThu, TranDau, ThamGia)
    â””â”€ Pub_CLB2_SD2  (4 articles: DoiBong, CauThu, TranDau, ThamGia)

================================================================================
6. THIáº¾T Láº¬P SUBSCRIBERS (NGH1 & NGH2)
================================================================================

ğŸ“ BÆ¯á»šC 1: Táº O DATABASE Rá»–NG TRÃŠN SUBSCRIBERS

-- Káº¿t ná»‘i vÃ o localhost\NGH1 trong SSMS

USE master;
GO

CREATE DATABASE QL_BongDa_CLB1_SD1;
GO

-- âš ï¸ KHÃ”NG Cáº¦N táº¡o báº£ng thá»§ cÃ´ng!
-- Replication sáº½ tá»± Ä‘á»™ng táº¡o schema khi subscribe


-- Káº¿t ná»‘i vÃ o localhost\NGH2 trong SSMS

USE master;
GO

CREATE DATABASE QL_BongDa_CLB2_SD2;
GO

ğŸ“ BÆ¯á»šC 2: Táº O SUBSCRIPTION CHO NGH1

-- Quay láº¡i PUBLISHER (Winter) trong SSMS

    1. Expand "Replication" â†’ "Local Publications"
    
    2. Click pháº£i "Pub_CLB1_SD1" â†’ "New Subscriptions..."
    
    3. New Subscription Wizard:
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 1: Publication                                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Publisher:       Winter                                     â”‚
    â”‚ Database:        QL_BongDa                                  â”‚
    â”‚ Publication:     Pub_CLB1_SD1                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 2: Distribution Agent Location                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â¦¿ Run all agents at the Distributor (push)    â† CHá»ŒN       â”‚
    â”‚   Khuyáº¿n nghá»‹ cho Transactional Replication                â”‚
    â”‚                                                             â”‚
    â”‚ âšª Run each agent at its Subscriber (pull)                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 3: Subscribers                                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Click "Add Subscriber" â†’ "Add SQL Server Subscriber..."    â”‚
    â”‚                                                             â”‚
    â”‚ Server name:       localhost\NGH1                           â”‚
    â”‚ Authentication:    SQL Server Authentication                â”‚
    â”‚   Login:           sa                                       â”‚
    â”‚   Password:        123456                                   â”‚
    â”‚                                                             â”‚
    â”‚ Click "Connect" â†’ Chá»n database:                            â”‚
    â”‚ Subscription Database:  QL_BongDa_CLB1_SD1                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 4: Distribution Agent Security                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Click "..." button                                          â”‚
    â”‚                                                             â”‚
    â”‚ Process account:                                            â”‚
    â”‚ â¦¿ Run under the SQL Server Agent service account           â”‚
    â”‚                                                             â”‚
    â”‚ Connect to Subscriber:                                      â”‚
    â”‚ âšª By impersonating the process account                     â”‚
    â”‚ â¦¿ Using the following SQL Server login:                    â”‚
    â”‚   Login:           sa                                       â”‚
    â”‚   Password:        123456                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 5: Synchronization Schedule                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Agent Schedule:                                             â”‚
    â”‚ â¦¿ Run continuously     â† CHá»ŒN (Real-time sync)              â”‚
    â”‚ âšª Run on demand only                                        â”‚
    â”‚ âšª Define schedule...                                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 6: Initialize Subscriptions                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Initialize When:                                            â”‚
    â”‚ â¦¿ Immediately          â† CHá»ŒN (Äá»“ng bá»™ ngay láº­p tá»©c)       â”‚
    â”‚ âšª At first synchronization                                 â”‚
    â”‚ âšª Initialize from backup                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 7: Wizard Actions                                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ â˜‘ Create the subscription(s)                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    Click "Finish" â†’ Chá» 30-60s
    
    âœ… Káº¿t quáº£: "Successfully created the subscription"

ğŸ“ BÆ¯á»šC 3: Táº O SUBSCRIPTION CHO NGH2

-- LÃ m TÆ¯Æ NG Tá»° nhÆ° NGH1, nhÆ°ng:

    Publication:            Pub_CLB2_SD2       â† KhÃ¡c
    Subscriber:             localhost\NGH2     â† KhÃ¡c
    Subscription Database:  QL_BongDa_CLB2_SD2 â† KhÃ¡c

================================================================================
7. Äá»’NG Bá»˜ VÃ€ KIá»‚M TRA Dá»® LIá»†U
================================================================================

ğŸ“ BÆ¯á»šC 1: XEM TRáº NG THÃI Äá»’NG Bá»˜

-- TrÃªn PUBLISHER (Winter):

    1. Expand "Replication" â†’ "Local Publications" â†’ "Pub_CLB1_SD1"
    
    2. Click pháº£i â†’ "View Synchronization Status"
    
    3. Cá»­a sá»• xuáº¥t hiá»‡n, xem log:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Subscription: localhost\NGH1 : QL_BongDa_CLB1_SD1     â”‚
       â”‚ Status:       â— Running                               â”‚
       â”‚                                                       â”‚
       â”‚ Last Action:                                          â”‚
       â”‚ âœ… A snapshot of 4 article(s) was generated           â”‚
       â”‚ âœ… 100% completed; delivering snapshot...             â”‚
       â”‚ âœ… The replication agent has not logged a history     â”‚
       â”‚    message in the last 10 minutes                    â”‚
       â”‚    (NghÄ©a lÃ  Ä‘Ã£ xong vÃ  Ä‘ang chá» changes)            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    4. LÃ m tÆ°Æ¡ng tá»± vá»›i "Pub_CLB2_SD2"

ğŸ“ BÆ¯á»šC 2: KIá»‚M TRA Dá»® LIá»†U TRÃŠN SUBSCRIBERS

-- Káº¿t ná»‘i vÃ o localhost\NGH1 trong SSMS:

USE QL_BongDa_CLB1_SD1;
GO

-- Kiá»ƒm tra DoiBong (CHá»ˆ cÃ³ CLB1)
SELECT * FROM DoiBong;
/*
Káº¿t quáº£ mong Ä‘á»£i:
MaDB  TenDB              CLB
----  -----------------  ----
DB01  Manchester City    CLB1
DB02  Arsenal            CLB1
*/

-- Kiá»ƒm tra CauThu (CHá»ˆ cÃ³ cáº§u thá»§ cá»§a CLB1)
SELECT COUNT(*) AS TongCauThu FROM CauThu;
-- Káº¿t quáº£: 22 cáº§u thá»§ (CT01-CT22)

-- Kiá»ƒm tra TranDau (CHá»ˆ cÃ³ tráº­n táº¡i SD1)
SELECT * FROM TranDau;
/*
Káº¿t quáº£ mong Ä‘á»£i:
MaTD  MaDB1  MaDB2  TrongTai         SanDau
----  -----  -----  ---------------  ------
TD01  DB01   DB02   Michael Oliver   SD1
TD03  DB01   DB03   Szymon Marciniak SD1
TD05  DB03   DB01   Clement Turpin   SD1
*/

-- Kiá»ƒm tra ThamGia (CHá»ˆ cÃ³ records cá»§a 3 tráº­n trÃªn)
SELECT COUNT(*) AS TongRecords FROM ThamGia;
-- Káº¿t quáº£: 12 records (4 cáº§u thá»§/tráº­n Ã— 3 tráº­n)


-- Káº¿t ná»‘i vÃ o localhost\NGH2 trong SSMS:

USE QL_BongDa_CLB2_SD2;
GO

-- Kiá»ƒm tra DoiBong (CHá»ˆ cÃ³ CLB2)
SELECT * FROM DoiBong;
/*
Káº¿t quáº£ mong Ä‘á»£i:
MaDB  TenDB          CLB
----  -------------  ----
DB03  Real Madrid    CLB2
DB04  Barcelona      CLB2
*/

-- Kiá»ƒm tra CauThu (CHá»ˆ cÃ³ cáº§u thá»§ cá»§a CLB2)
SELECT COUNT(*) AS TongCauThu FROM CauThu;
-- Káº¿t quáº£: 22 cáº§u thá»§ (CT23-CT44)

-- Kiá»ƒm tra TranDau (CHá»ˆ cÃ³ tráº­n táº¡i SD2)
SELECT * FROM TranDau;
/*
Káº¿t quáº£ mong Ä‘á»£i:
MaTD  MaDB1  MaDB2  TrongTai            SanDau
----  -----  -----  ------------------  ------
TD02  DB03   DB04   Antonio Mateu Lahoz SD2
TD04  DB02   DB04   Daniele Orsato     SD2
TD06  DB04   DB02   Carlos del Cerro    SD2
*/

-- Kiá»ƒm tra ThamGia
SELECT COUNT(*) AS TongRecords FROM ThamGia;
-- Káº¿t quáº£: 12 records

ğŸ“ BÆ¯á»šC 3: TEST Äá»’NG Bá»˜ REAL-TIME

âš ï¸ QUAN TRá»ŒNG: Test xem khi INSERT vÃ o Publisher, Subscriber cÃ³ tá»± Ä‘á»™ng cáº­p nháº­t khÃ´ng!

-- TrÃªn PUBLISHER (Winter):

USE QL_BongDa;
GO

-- Test 1: ThÃªm Ä‘á»™i má»›i vÃ o CLB1
INSERT INTO DoiBong VALUES ('DB05', N'Liverpool', N'CLB1');
GO

-- Chá» 5-10 giÃ¢y, rá»“i kiá»ƒm tra NGH1:

USE QL_BongDa_CLB1_SD1;
GO

SELECT * FROM DoiBong WHERE MaDB = 'DB05';
-- âœ… Káº¿t quáº£: DB05 xuáº¥t hiá»‡n táº¡i NGH1!

-- Kiá»ƒm tra NGH2:
USE QL_BongDa_CLB2_SD2;
GO

SELECT * FROM DoiBong WHERE MaDB = 'DB05';
-- âœ… Káº¿t quáº£: KHÃ”NG cÃ³ DB05 (vÃ¬ filter CLB = 'CLB2')


-- Test 2: ThÃªm Ä‘á»™i CLB2
USE QL_BongDa;
GO

INSERT INTO DoiBong VALUES ('DB06', N'Atletico Madrid', N'CLB2');
GO

-- Chá» 5-10 giÃ¢y
-- NGH2: âœ… CÃ³ DB06
-- NGH1: âœ… KHÃ”NG cÃ³ DB06


-- Test 3: ThÃªm cáº§u thá»§
INSERT INTO CauThu VALUES ('CT45', N'Mohamed Salah', N'Tiá»n Ä‘áº¡o', 'DB05');
GO

-- NGH1: âœ… CÃ³ CT45 (vÃ¬ DB05 thuá»™c CLB1)
-- NGH2: âœ… KHÃ”NG cÃ³ CT45


-- Test 4: ThÃªm tráº­n Ä‘áº¥u
INSERT INTO TranDau VALUES ('TD07', 'DB05', 'DB01', N'Anthony Taylor', N'SD1');
GO

-- NGH1: âœ… CÃ³ TD07 (vÃ¬ SanDau = SD1)
-- NGH2: âœ… KHÃ”NG cÃ³ TD07

================================================================================
8. MONITORING & TROUBLESHOOTING
================================================================================

ğŸ“Š XEM TRáº NG THÃI REPLICATION

-- TrÃªn PUBLISHER (Winter):

USE distribution;
GO

-- Xem táº¥t cáº£ subscriptions
SELECT 
    s.subscriber_server AS Subscriber,
    s.subscriber_db AS [Database],
    p.publication AS Publication,
    CASE s.status 
        WHEN 0 THEN 'Inactive'
        WHEN 1 THEN 'Subscribed'
        WHEN 2 THEN 'Active'
    END AS Status,
    a.name AS Agent,
    a.last_action_time AS LastSync
FROM distribution.dbo.MSsubscriptions s
JOIN distribution.dbo.MSpublications p ON s.publication_id = p.publication_id
LEFT JOIN distribution.dbo.MSdistribution_agents a ON s.agent_id = a.id;

-- Xem Distribution Agent status
EXEC sp_replmonitorhelpsubscription 
    @publication = N'Pub_CLB1_SD1',
    @publication_type = 0;

âš ï¸ COMMON ISSUES & SOLUTIONS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Issue 1: "Cannot connect to Subscriber 'localhost\NGH1'"       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NguyÃªn nhÃ¢n:                                                    â”‚
â”‚   - SQL Server Browser service khÃ´ng cháº¡y                       â”‚
â”‚   - TCP/IP protocol chÆ°a enable                                 â”‚
â”‚   - Firewall block                                              â”‚
â”‚                                                                 â”‚
â”‚ Giáº£i phÃ¡p:                                                      â”‚
â”‚   1. Services â†’ "SQL Server Browser" â†’ Start                   â”‚
â”‚   2. Configuration Manager â†’ Enable TCP/IP                      â”‚
â”‚   3. Táº¯t firewall hoáº·c thÃªm exception                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Issue 2: "The process could not connect to Subscriber"         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NguyÃªn nhÃ¢n:                                                    â”‚
â”‚   - Sai login/password                                          â”‚
â”‚   - SQL Authentication chÆ°a enable trÃªn Subscriber              â”‚
â”‚                                                                 â”‚
â”‚ Giáº£i phÃ¡p:                                                      â”‚
â”‚   1. Check login sa/123456 trÃªn NGH1, NGH2                      â”‚
â”‚   2. Enable Mixed Mode Authentication                           â”‚
â”‚   3. Restart SQL Server service                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Issue 3: "Snapshot folder not accessible"                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NguyÃªn nhÃ¢n:                                                    â”‚
â”‚   - ThÆ° má»¥c snapshot khÃ´ng cÃ³ quyá»n truy cáº­p                    â”‚
â”‚                                                                 â”‚
â”‚ Giáº£i phÃ¡p:                                                      â”‚
â”‚   1. Click pháº£i thÆ° má»¥c ReplData â†’ Properties â†’ Sharing        â”‚
â”‚   2. Share â†’ Add "Everyone" â†’ Full Control                      â”‚
â”‚   3. Security tab â†’ Add "Everyone" â†’ Full Control               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Issue 4: "The subscription does not exist"                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Giáº£i phÃ¡p:                                                      â”‚
â”‚   - XÃ³a vÃ  táº¡o láº¡i subscription                                 â”‚
â”‚   - Hoáº·c reinitialize subscription                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Issue 5: "Agent is not running"                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Giáº£i phÃ¡p:                                                      â”‚
â”‚   - Services â†’ Start "SQL Server Agent"                         â”‚
â”‚   - Hoáº·c: NET START SQLSERVERAGENT                              â”‚
â”‚   - Set Start Mode = Automatic                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ XÃ“A VÃ€ Táº O Láº I REPLICATION (Náº¿u cáº§n reset)

-- 1. XÃ³a Subscription
EXEC sp_dropsubscription 
    @publication = N'Pub_CLB1_SD1',
    @subscriber = N'localhost\NGH1',
    @article = N'all',
    @destination_db = N'QL_BongDa_CLB1_SD1';

-- 2. XÃ³a Publication
EXEC sp_droppublication @publication = N'Pub_CLB1_SD1';

-- 3. Disable Publishing
EXEC sp_replicationdboption 
    @dbname = N'QL_BongDa',
    @optname = N'publish',
    @value = N'false';

-- 4. Remove Distributor
EXEC sp_dropdistributor @no_checks = 1;

-- Sau Ä‘Ã³ lÃ m láº¡i tá»« Ä‘áº§u!

================================================================================
Káº¾T LUáº¬N
================================================================================

âœ… ÄÃƒ HOÃ€N THÃ€NH:

    1. âœ… Cáº¥u hÃ¬nh 1 Publisher (Winter) vá»›i Global Schema
    2. âœ… Cáº¥u hÃ¬nh 2 Subscribers (NGH1, NGH2)
    3. âœ… Táº¡o 2 Publications vá»›i Horizontal Filtering:
       - Pub_CLB1_SD1: Filter DoiBong (CLB1), TranDau (SD1)
       - Pub_CLB2_SD2: Filter DoiBong (CLB2), TranDau (SD2)
    4. âœ… Táº¡o 2 Subscriptions (Push, Real-time)
    5. âœ… Äá»“ng bá»™ dá»¯ liá»‡u tá»± Ä‘á»™ng tá»« Publisher â†’ Subscribers

ğŸ¯ Káº¾T QUáº¢ PHÃ‚N Máº¢NH:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Winter (Publisher):                                    â”‚
    â”‚   - 4 Ä‘á»™i (DB01-DB04)                                  â”‚
    â”‚   - 44 cáº§u thá»§ (CT01-CT44)                             â”‚
    â”‚   - 6 tráº­n Ä‘áº¥u (TD01-TD06)                             â”‚
    â”‚   - 24 records ThamGia                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ NGH1:         â”‚         â”‚ NGH2:         â”‚
    â”‚ - 2 Ä‘á»™i CLB1  â”‚         â”‚ - 2 Ä‘á»™i CLB2  â”‚
    â”‚ - 22 cáº§u thá»§  â”‚         â”‚ - 22 cáº§u thá»§  â”‚
    â”‚ - 3 tráº­n SD1  â”‚         â”‚ - 3 tráº­n SD2  â”‚
    â”‚ - 12 ThamGia  â”‚         â”‚ - 12 ThamGia  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸš€ Lá»¢I ÃCH Cá»¦A REPLICATION:

    âœ… Äá»“ng bá»™ tá»± Ä‘á»™ng: INSERT trÃªn Winter â†’ Tá»± Ä‘á»™ng nháº£y sang Subscriber
    âœ… Real-time: Äá»“ng bá»™ gáº§n nhÆ° tá»©c thÃ¬ (5-10 giÃ¢y)
    âœ… Horizontal Filter: Má»—i Subscriber chá»‰ nháº­n dá»¯ liá»‡u cáº§n thiáº¿t
    âœ… Giáº£m táº£i: JavaFX app cÃ³ thá»ƒ query trá»±c tiáº¿p Subscribers
    âœ… High Availability: Náº¿u Publisher down, Subscribers váº«n read Ä‘Æ°á»£c
    âœ… Dá»… má»Ÿ rá»™ng: ThÃªm CLB3, CLB4 chá»‰ cáº§n táº¡o thÃªm Publication

ğŸ“ á»¨NG Dá»¤NG TRONG Dá»° ÃN JAVAFX:

    DatabaseConnection.java sáº½ káº¿t ná»‘i Ä‘áº¿n:
    - Winter:  Cho global queries (query 10, dashboard)
    - NGH1:    Cho queries vá» CLB1/SD1 (query 1, 3, 9)
    - NGH2:    Cho queries vá» CLB2/SD2
    
    â†’ TÄƒng hiá»‡u nÄƒng, giáº£m táº£i cho Publisher!

ğŸ“š TÃ€I LIá»†U THAM KHáº¢O:

    - SQL Server Transactional Replication (Microsoft Docs)
    - Replication with Filtered Data
    - Monitoring Replication
    - Troubleshooting Replication

ğŸ“§ LiÃªn há»‡: [ThÃ´ng tin sinh viÃªn/nhÃ³m]
ğŸ“… NgÃ y: 18/11/2025

================================================================================
                            Háº¾T
================================================================================

================================================================================
PHá»¤ Lá»¤C: SCHEMA DATABASE
================================================================================

ğŸ“Š SCHEMA CHI TIáº¾T:

CREATE TABLE DoiBong (
    MaDB CHAR(4) PRIMARY KEY,
    TenDB NVARCHAR(50),
    CLB NVARCHAR(20)        -- CLB1 hoáº·c CLB2
);

CREATE TABLE CauThu (
    MaCT VARCHAR(10) PRIMARY KEY,
    HoTen NVARCHAR(50),
    ViTri NVARCHAR(20),
    MaDB CHAR(4) NOT NULL,
    FOREIGN KEY (MaDB) REFERENCES DoiBong(MaDB)
);

CREATE TABLE TranDau (
    MaTD CHAR(4) PRIMARY KEY,
    MaDB1 CHAR(4) NOT NULL,     -- Äá»™i 1
    MaDB2 CHAR(4) NOT NULL,     -- Äá»™i 2
    TrongTai NVARCHAR(50),
    SanDau NVARCHAR(20),        -- SD1 hoáº·c SD2
    FOREIGN KEY (MaDB1) REFERENCES DoiBong(MaDB),
    FOREIGN KEY (MaDB2) REFERENCES DoiBong(MaDB)
);

CREATE TABLE ThamGia (
    MaTD CHAR(4),
    MaCT VARCHAR(10),
    SoTrai INT CHECK (SoTrai >= 0),
    PRIMARY KEY (MaTD, MaCT),
    FOREIGN KEY (MaTD) REFERENCES TranDau(MaTD),
    FOREIGN KEY (MaCT) REFERENCES CauThu(MaCT)
);

ğŸ“ Dá»® LIá»†U MáºªU:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WINTER (Global) - ToÃ n bá»™ dá»¯ liá»‡u                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DoiBong:   4 Ä‘á»™i (DB01, DB02, DB03, DB04)                    â”‚
â”‚ CauThu:    44 cáº§u thá»§ (11 ngÆ°á»i/Ä‘á»™i)                         â”‚
â”‚ TranDau:   6 tráº­n Ä‘áº¥u                                         â”‚
â”‚ ThamGia:   24 records (4 cáº§u thá»§/tráº­n)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NGH1 (Máº£nh CLB1 + SD1)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DoiBong:   2 Ä‘á»™i (DB01: Man City, DB02: Arsenal)             â”‚
â”‚ CauThu:    22 cáº§u thá»§ (CT01-CT22)                            â”‚
â”‚ TranDau:   3 tráº­n táº¡i SD1 (TD01, TD03, TD05)                 â”‚
â”‚ ThamGia:   12 records (cá»§a 3 tráº­n trÃªn)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NGH2 (Máº£nh CLB2 + SD2)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DoiBong:   2 Ä‘á»™i (DB03: Real Madrid, DB04: Barcelona)        â”‚
â”‚ CauThu:    22 cáº§u thá»§ (CT23-CT44)                            â”‚
â”‚ TranDau:   3 tráº­n táº¡i SD2 (TD02, TD04, TD06)                 â”‚
â”‚ ThamGia:   12 records (cá»§a 3 tráº­n trÃªn)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
5. Káº¾T Ná»I Tá»ª JAVAFX
================================================================================

ğŸ“ FILE: DatabaseConnection.java

package org.football.utils;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DatabaseConnection {

    private static final String DB_USER = "sa";
    private static final String DB_PASS = "123456";

    // ===== INSTANCE 1: GLOBAL SCHEMA (Winter) =====
    private static final String WINTER_INSTANCE = "Winter";
    private static final String WINTER_DB_NAME = "QL_BongDa";
    
    // ===== INSTANCE 2: Máº¢NH 1 (NGH1) =====
    private static final String DB1_INSTANCE = "localhost\\NGH1";
    private static final String DB1_NAME = "QL_BongDa_CLB1_SD1";
    
    // ===== INSTANCE 3: Máº¢NH 2 (NGH2) =====
    private static final String DB2_INSTANCE = "localhost\\NGH2";
    private static final String DB2_NAME = "QL_BongDa_CLB2_SD2";

    private static Connection connectionWinter = null;
    private static Connection connection1 = null;
    private static Connection connection2 = null;

    /**
     * Káº¿t ná»‘i Ä‘áº¿n Global Schema (Winter)
     * Chá»©a TOÃ€N Bá»˜ dá»¯ liá»‡u
     */
    public static Connection getConnectionGlobal() {
        try {
            if (connectionWinter == null || connectionWinter.isClosed()) {
                String url = "jdbc:sqlserver://" + WINTER_INSTANCE + 
                             ";databaseName=" + WINTER_DB_NAME + 
                             ";encrypt=true;trustServerCertificate=true";
                connectionWinter = DriverManager.getConnection(url, DB_USER, DB_PASS);
            }
            return connectionWinter;
        } catch (SQLException e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * Káº¿t ná»‘i Ä‘áº¿n Máº£nh 1 (NGH1)
     * CLB1 + SD1
     */
    public static Connection getConnection1() {
        try {
            if (connection1 == null || connection1.isClosed()) {
                String url = "jdbc:sqlserver://" + DB1_INSTANCE + 
                             ";databaseName=" + DB1_NAME + 
                             ";encrypt=true;trustServerCertificate=true";
                connection1 = DriverManager.getConnection(url, DB_USER, DB_PASS);
            }
            return connection1;
        } catch (SQLException e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * Káº¿t ná»‘i Ä‘áº¿n Máº£nh 2 (NGH2)
     * CLB2 + SD2
     */
    public static Connection getConnection2() {
        try {
            if (connection2 == null || connection2.isClosed()) {
                String url = "jdbc:sqlserver://" + DB2_INSTANCE + 
                             ";databaseName=" + DB2_NAME + 
                             ";encrypt=true;trustServerCertificate=true";
                connection2 = DriverManager.getConnection(url, DB_USER, DB_PASS);
            }
            return connection2;
        } catch (SQLException e) {
            e.printStackTrace();
            return null;
        }
    }
    
    /**
     * ÄÃ³ng táº¥t cáº£ káº¿t ná»‘i
     */
    public static void closeAll() {
        try {
            if (connectionWinter != null && !connectionWinter.isClosed()) 
                connectionWinter.close();
            if (connection1 != null && !connection1.isClosed()) 
                connection1.close();
            if (connection2 != null && !connection2.isClosed()) 
                connection2.close();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
}

================================================================================
6. Xá»¬ LÃ TRUY Váº¤N PHÃ‚N TÃN
================================================================================

ğŸ¯ NGUYÃŠN Táº®C Xá»¬ LÃ:

1. INSERT/UPDATE/DELETE:
   â”œâ”€ XÃ¡c Ä‘á»‹nh dá»¯ liá»‡u thuá»™c máº£nh nÃ o (dá»±a vÃ o CLB hoáº·c SanDau)
   â”œâ”€ Thá»±c hiá»‡n trÃªn máº£nh tÆ°Æ¡ng á»©ng (Connection1 hoáº·c Connection2)
   â””â”€ (Optional) Äá»“ng bá»™ lÃªn Global schema náº¿u cáº§n

2. SELECT (Query):
   â”œâ”€ Náº¿u biáº¿t máº£nh â†’ Query 1 instance
   â”œâ”€ Náº¿u khÃ´ng biáº¿t â†’ Query cáº£ 2 instance vÃ  MERGE káº¿t quáº£
   â””â”€ Xá»­ lÃ½ JOIN giá»¯a cÃ¡c máº£nh (náº¿u cáº§n)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VÃ Dá»¤ 1: INSERT Äá»˜I BÃ“NG                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ public boolean insert(DoiBong doiBong, String clb) {                   â”‚
â”‚     // XÃ¡c Ä‘á»‹nh máº£nh dá»±a vÃ o CLB                                        â”‚
â”‚     Connection conn = clb.equals("CLB1")                                â”‚
â”‚         ? DatabaseConnection.getConnection1()    // NGH1                â”‚
â”‚         : DatabaseConnection.getConnection2();   // NGH2                â”‚
â”‚                                                                         â”‚
â”‚     String sql = "INSERT INTO DoiBong (MaDB, TenDB, CLB) VALUES (?, ?, ?)";â”‚
â”‚     PreparedStatement ps = conn.prepareStatement(sql);                  â”‚
â”‚     ps.setString(1, doiBong.getMaDB());                                 â”‚
â”‚     ps.setString(2, doiBong.getTenDB());                                â”‚
â”‚     ps.setString(3, doiBong.getClb());                                  â”‚
â”‚     return ps.executeUpdate() > 0;                                      â”‚
â”‚ }                                                                       â”‚
â”‚                                                                         â”‚
â”‚ ğŸ“Œ Káº¾T QUáº¢:                                                             â”‚
â”‚    - CLB1 â†’ LÆ°u vÃ o NGH1                                                â”‚
â”‚    - CLB2 â†’ LÆ°u vÃ o NGH2                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VÃ Dá»¤ 2: SELECT Táº¤T Cáº¢ Äá»˜I BÃ“NG (MERGE 2 Máº¢NH)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ public List<DoiBong> findAllMerged() {                                 â”‚
â”‚     List<DoiBong> merged = new ArrayList<>();                           â”‚
â”‚                                                                         â”‚
â”‚     // Query tá»« NGH1                                                    â”‚
â”‚     merged.addAll(findAll(DatabaseConnection.getConnection1()));        â”‚
â”‚                                                                         â”‚
â”‚     // Query tá»« NGH2                                                    â”‚
â”‚     merged.addAll(findAll(DatabaseConnection.getConnection2()));        â”‚
â”‚                                                                         â”‚
â”‚     return merged;                                                      â”‚
â”‚ }                                                                       â”‚
â”‚                                                                         â”‚
â”‚ private List<DoiBong> findAll(Connection conn) {                       â”‚
â”‚     List<DoiBong> list = new ArrayList<>();                             â”‚
â”‚     String sql = "SELECT * FROM DoiBong ORDER BY MaDB";                 â”‚
â”‚     Statement stmt = conn.createStatement();                            â”‚
â”‚     ResultSet rs = stmt.executeQuery(sql);                              â”‚
â”‚     while (rs.next()) {                                                 â”‚
â”‚         list.add(new DoiBong(...));                                     â”‚
â”‚     }                                                                   â”‚
â”‚     return list;                                                        â”‚
â”‚ }                                                                       â”‚
â”‚                                                                         â”‚
â”‚ ğŸ“Œ Káº¾T QUáº¢:                                                             â”‚
â”‚    - Query NGH1 â†’ [DB01, DB02]                                          â”‚
â”‚    - Query NGH2 â†’ [DB03, DB04]                                          â”‚
â”‚    - Merge â†’ [DB01, DB02, DB03, DB04]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VÃ Dá»¤ 3: QUERY 4 - VUA PHÃ LÆ¯á»šI (Aggregate tá»« 2 máº£nh)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ public List<Map<String, Object>> query4_TopScorers() {                 â”‚
â”‚     Map<String, TopScorerData> scorers = new HashMap<>();               â”‚
â”‚                                                                         â”‚
â”‚     // Query tá»« NGH1                                                    â”‚
â”‚     String sql = "SELECT CT.MaCT, CT.HoTen, SUM(TG.SoTrai) AS TongBan  â”‚
â”‚                   FROM CauThu CT                                        â”‚
â”‚                   JOIN ThamGia TG ON CT.MaCT = TG.MaCT                 â”‚
â”‚                   GROUP BY CT.MaCT, CT.HoTen";                          â”‚
â”‚                                                                         â”‚
â”‚     ResultSet rs1 = conn1.createStatement().executeQuery(sql);          â”‚
â”‚     while (rs1.next()) {                                                â”‚
â”‚         String maCT = rs1.getString("MaCT");                            â”‚
â”‚         scorers.put(maCT, new TopScorerData(                            â”‚
â”‚             maCT,                                                       â”‚
â”‚             rs1.getString("HoTen"),                                     â”‚
â”‚             rs1.getInt("TongBan")                                       â”‚
â”‚         ));                                                             â”‚
â”‚     }                                                                   â”‚
â”‚                                                                         â”‚
â”‚     // Query tá»« NGH2 vÃ  MERGE                                           â”‚
â”‚     ResultSet rs2 = conn2.createStatement().executeQuery(sql);          â”‚
â”‚     while (rs2.next()) {                                                â”‚
â”‚         String maCT = rs2.getString("MaCT");                            â”‚
â”‚         if (scorers.containsKey(maCT)) {                                â”‚
â”‚             // Cáº§u thá»§ Ä‘Ã£ cÃ³ â†’ Cá»™ng thÃªm bÃ n tháº¯ng                      â”‚
â”‚             scorers.get(maCT).tongBan += rs2.getInt("TongBan");         â”‚
â”‚         } else {                                                        â”‚
â”‚             scorers.put(maCT, new TopScorerData(...));                  â”‚
â”‚         }                                                               â”‚
â”‚     }                                                                   â”‚
â”‚                                                                         â”‚
â”‚     // Sort vÃ  return                                                   â”‚
â”‚     return scorers.values().stream()                                    â”‚
â”‚         .sorted((a, b) -> Integer.compare(b.tongBan, a.tongBan))        â”‚
â”‚         .collect(Collectors.toList());                                  â”‚
â”‚ }                                                                       â”‚
â”‚                                                                         â”‚
â”‚ ğŸ“Œ Káº¾T QUáº¢:                                                             â”‚
â”‚    - NGH1: CT11 (Haaland) - 5 bÃ n (2+2+1)                               â”‚
â”‚    - NGH2: CT33 (MbappÃ©) - 3 bÃ n (1+2)                                  â”‚
â”‚    - Merge & Sort â†’ Top scorer: CT11 vá»›i 5 bÃ n                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VÃ Dá»¤ 4: QUERY 1 - TÃŒM Cáº¦U THá»¦ THEO CLB (Query 1 máº£nh)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ public List<CauThu> query1_FindByCLB(String clb) {                     â”‚
â”‚     // XÃ¡c Ä‘á»‹nh máº£nh dá»±a vÃ o CLB                                        â”‚
â”‚     Connection conn = clb.equals("CLB1")                                â”‚
â”‚         ? DatabaseConnection.getConnection1()    // NGH1                â”‚
â”‚         : DatabaseConnection.getConnection2();   // NGH2                â”‚
â”‚                                                                         â”‚
â”‚     String sql = "SELECT CT.* " +                                       â”‚
â”‚                  "FROM CauThu CT " +                                    â”‚
â”‚                  "JOIN DoiBong DB ON CT.MaDB = DB.MaDB " +              â”‚
â”‚                  "WHERE DB.CLB = ?";                                    â”‚
â”‚                                                                         â”‚
â”‚     PreparedStatement ps = conn.prepareStatement(sql);                  â”‚
â”‚     ps.setString(1, clb);                                               â”‚
â”‚     ResultSet rs = ps.executeQuery();                                   â”‚
â”‚                                                                         â”‚
â”‚     List<CauThu> result = new ArrayList<>();                            â”‚
â”‚     while (rs.next()) {                                                 â”‚
â”‚         result.add(new CauThu(...));                                    â”‚
â”‚     }                                                                   â”‚
â”‚     return result;                                                      â”‚
â”‚ }                                                                       â”‚
â”‚                                                                         â”‚
â”‚ ğŸ“Œ Káº¾T QUáº¢:                                                             â”‚
â”‚    - CLB1 â†’ Query chá»‰ NGH1 (khÃ´ng cáº§n NGH2)                             â”‚
â”‚    - CLB2 â†’ Query chá»‰ NGH2 (khÃ´ng cáº§n NGH1)                             â”‚
â”‚    - Tiáº¿t kiá»‡m thá»i gian, khÃ´ng query thá»«a!                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
7. VÃ Dá»¤ THá»°C Táº¾ - 10 CÃ‚U TRUY Váº¤N PHÃ‚N TÃN
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 1: TÃ¬m cáº§u thá»§ theo CLB                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  CLB = "CLB1"                                                    â”‚
â”‚ Logic:  Query chá»‰ NGH1 (vÃ¬ CLB1 náº±m trong máº£nh 1)                      â”‚
â”‚ Output: 22 cáº§u thá»§ cá»§a Man City + Arsenal                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 2: Äáº¿m sá»‘ tráº­n cá»§a cáº§u thá»§                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  HoTen = "Erling Haaland"                                       â”‚
â”‚ Logic:  Query NGH1 + NGH2 (cáº§u thá»§ cÃ³ thá»ƒ Ä‘Ã¡ tráº­n á»Ÿ cáº£ 2 sÃ¢n)         â”‚
â”‚ Output: 3 tráº­n (TD01, TD03, TD05 - táº¥t cáº£ táº¡i SD1)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 3: Sá»‘ tráº­n hÃ²a theo sÃ¢n                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  SanDau = "SD1"                                                  â”‚
â”‚ Logic:  Query chá»‰ NGH1 (vÃ¬ SD1 náº±m trong máº£nh 1)                       â”‚
â”‚         TÃ­nh tá»· sá»‘ má»—i tráº­n, Ä‘áº¿m tráº­n cÃ³ tá»· sá»‘ báº±ng nhau               â”‚
â”‚ Output: 0 tráº­n hÃ²a (giáº£ sá»­)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 4: Vua phÃ¡ lÆ°á»›i                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Logic:  Query NGH1 + NGH2, aggregate bÃ n tháº¯ng, merge vÃ  sort          â”‚
â”‚ Output: CT11 (Erling Haaland) - 5 bÃ n                                  â”‚
â”‚         CT33 (Kylian MbappÃ©) - 3 bÃ n                                    â”‚
â”‚         CT44 (Robert Lewandowski) - 3 bÃ n                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 5: Tráº­n cÃ³ cáº§u thá»§ X vÃ  trá»ng tÃ i Y                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  HoTen = "Haaland", TrongTai = "Michael Oliver"                 â”‚
â”‚ Logic:  Query NGH1 + NGH2, filter vÃ  merge                              â”‚
â”‚ Output: TD01 (Man City vs Arsenal, trá»ng tÃ i Michael Oliver)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 6: Kiá»ƒm tra 2 cáº§u thá»§ cÃ¹ng CLB                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  HoTen1 = "Haaland", HoTen2 = "De Bruyne"                       â”‚
â”‚ Logic:  TÃ¬m CLB cá»§a má»—i cáº§u thá»§ (query NGH1 hoáº·c NGH2)                 â”‚
â”‚ Output: TRUE (cÃ¹ng CLB1 - Man City)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 7: Cáº§u thá»§ tham gia nhÆ°ng ghi 0 bÃ n                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Logic:  Query NGH1 + NGH2 WHERE SoTrai = 0, merge                      â”‚
â”‚ Output: Danh sÃ¡ch cáº§u thá»§ + sá»‘ tráº­n há» ra sÃ¢n nhÆ°ng khÃ´ng ghi bÃ n      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 8: Cáº§u thá»§ tÃ­ch cá»±c (>= 3 tráº­n)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Logic:  Query NGH1 + NGH2, COUNT(MaTD), merge vÃ  filter >= 3           â”‚
â”‚ Output: CT11 (Haaland) - 3 tráº­n                                        â”‚
â”‚         CT20 (Bukayo Saka) - 3 tráº­n                                     â”‚
â”‚         ...                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 9: Tá»•ng bÃ n tháº¯ng cá»§a Ä‘á»™i                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input:  MaDB = "DB01" (Man City)                                        â”‚
â”‚ Logic:  TÃ¬m CLB cá»§a Ä‘á»™i â†’ CLB1 â†’ Query NGH1                            â”‚
â”‚         SUM(TG.SoTrai) WHERE CT.MaDB = 'DB01'                           â”‚
â”‚ Output: 8 bÃ n tháº¯ng                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUERY 10: Cáº§u thá»§ chÆ°a tham gia tráº­n nÃ o                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Logic:  Query NGH1 + NGH2 vá»›i LEFT JOIN (WHERE TG.MaTD IS NULL)        â”‚
â”‚ Output: Danh sÃ¡ch cáº§u thá»§ chÆ°a cÃ³ record trong báº£ng ThamGia            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
8. CÃC BÆ¯á»šC THIáº¾T Láº¬P Há»† THá»NG
================================================================================

ğŸ“ BÆ¯á»šC 1: CÃ€I Äáº¶T SQL SERVER INSTANCES

1. CÃ i SQL Server vá»›i 3 instances:
   â”œâ”€ Default Instance (Winter hoáº·c tÃªn mÃ¡y)
   â”œâ”€ Named Instance 1: NGH1
   â””â”€ Named Instance 2: NGH2

2. Báº­t SQL Server Authentication (Mixed Mode)
   â”œâ”€ Username: sa
   â””â”€ Password: 123456

3. Báº­t TCP/IP protocol cho táº¥t cáº£ instances
   â”œâ”€ SQL Server Configuration Manager
   â”œâ”€ SQL Server Network Configuration
   â””â”€ Enable TCP/IP

ğŸ“ BÆ¯á»šC 2: Táº O DATABASE VÃ€ Dá»® LIá»†U

1. Cháº¡y script táº¡o database trÃªn Winter (Global):
   -- Táº¡o QL_BongDa
   -- Táº¡o 4 báº£ng (DoiBong, CauThu, TranDau, ThamGia)
   -- Insert dá»¯ liá»‡u máº«u (4 Ä‘á»™i, 44 cáº§u thá»§, 6 tráº­n)

2. Táº¡o Linked Server tá»« NGH1, NGH2 vá» Winter:
   EXEC sp_addlinkedserver 
       @server='WINTER_LINK',
       @srvproduct='',
       @provider='SQLNCLI',
       @datasrc='Winter';

3. Táº¡o máº£nh dá»¯ liá»‡u trÃªn NGH1:
   CREATE DATABASE QL_BongDa_CLB1_SD1;
   USE QL_BongDa_CLB1_SD1;
   
   -- Táº¡o cáº¥u trÃºc báº£ng (4 báº£ng)
   -- Copy dá»¯ liá»‡u CLB1 + SD1 tá»« Winter

4. Táº¡o máº£nh dá»¯ liá»‡u trÃªn NGH2:
   CREATE DATABASE QL_BongDa_CLB2_SD2;
   USE QL_BongDa_CLB2_SD2;
   
   -- Táº¡o cáº¥u trÃºc báº£ng (4 báº£ng)
   -- Copy dá»¯ liá»‡u CLB2 + SD2 tá»« Winter

ğŸ“ BÆ¯á»šC 3: KIá»‚M TRA Káº¾T Ná»I

1. Test káº¿t ná»‘i tá»« Java:
   Connection connWinter = DatabaseConnection.getConnectionGlobal();
   Connection conn1 = DatabaseConnection.getConnection1();
   Connection conn2 = DatabaseConnection.getConnection2();
   
   System.out.println("Winter: " + (connWinter != null));
   System.out.println("NGH1: " + (conn1 != null));
   System.out.println("NGH2: " + (conn2 != null));

2. Verify dá»¯ liá»‡u:
   -- Winter: 4 Ä‘á»™i, 44 cáº§u thá»§, 6 tráº­n
   -- NGH1: 2 Ä‘á»™i, 22 cáº§u thá»§, 3 tráº­n
   -- NGH2: 2 Ä‘á»™i, 22 cáº§u thá»§, 3 tráº­n

================================================================================
9. LÆ¯U Ã VÃ€ BEST PRACTICES
================================================================================

âœ… DO (NÃŠN):
   âœ“ XÃ¡c Ä‘á»‹nh rÃµ máº£nh dá»¯ liá»‡u trÆ°á»›c khi query
   âœ“ DÃ¹ng prepared statement Ä‘á»ƒ trÃ¡nh SQL injection
   âœ“ ÄÃ³ng káº¿t ná»‘i sau khi xong (try-with-resources)
   âœ“ Handle exception properly
   âœ“ Cache connection Ä‘á»ƒ trÃ¡nh má»Ÿ/Ä‘Ã³ng nhiá»u láº§n
   âœ“ Test ká»¹ cÃ¡c truy váº¥n phÃ¢n tÃ¡n

âŒ DON'T (KHÃ”NG NÃŠN):
   âœ— Hardcode connection string trong code
   âœ— Query táº¥t cáº£ máº£nh khi chá»‰ cáº§n 1 máº£nh
   âœ— Bá» qua exception handling
   âœ— QuÃªn Ä‘Ã³ng ResultSet, PreparedStatement, Connection
   âœ— Sá»­ dá»¥ng string concatenation cho SQL (dÃ¹ng PreparedStatement)

âš ï¸ COMMON ISSUES:
   
   1. "Login failed for user 'sa'"
      â†’ Kiá»ƒm tra password, SQL Server Authentication enabled
   
   2. "Cannot connect to localhost\NGH1"
      â†’ Kiá»ƒm tra SQL Server Browser service Ä‘ang cháº¡y
      â†’ Kiá»ƒm tra TCP/IP protocol enabled
   
   3. "Invalid object name 'DoiBong'"
      â†’ Database chÆ°a Ä‘Æ°á»£c táº¡o hoáº·c chÆ°a cÃ³ báº£ng
      â†’ Kiá»ƒm tra láº¡i databaseName trong connection string
   
   4. "Primary key violation"
      â†’ Kiá»ƒm tra MaDB/MaCT/MaTD Ä‘Ã£ tá»“n táº¡i trong máº£nh chÆ°a

================================================================================
10. TÃ€I LIá»†U THAM KHáº¢O
================================================================================

ğŸ“š TÃ i liá»‡u SQL Server:
   - Distributed Database Design
   - Horizontal Fragmentation
   - Linked Server Configuration
   - SQL Server Named Instances

ğŸ“š TÃ i liá»‡u Java:
   - JDBC Connection Pooling
   - PreparedStatement Best Practices
   - Exception Handling in Database Operations

ğŸ“š Kiáº¿n trÃºc phÃ¢n tÃ¡n:
   - CAP Theorem
   - Data Partitioning Strategies
   - Distributed Query Processing

================================================================================
Káº¾T LUáº¬N
================================================================================

Há»‡ thá»‘ng phÃ¢n tÃ¡n 3 instances nÃ y cho phÃ©p:

âœ… PhÃ¢n tÃ¡ch dá»¯ liá»‡u theo logic nghiá»‡p vá»¥ (CLB, SÃ¢n Ä‘áº¥u)
âœ… TÄƒng hiá»‡u nÄƒng query (query máº£nh thay vÃ¬ toÃ n bá»™)
âœ… Dá»… dÃ ng má»Ÿ rá»™ng (thÃªm CLB3, CLB4...)
âœ… Minh há»a rÃµ rÃ ng khÃ¡i niá»‡m phÃ¢n máº£nh ngang
âœ… Thá»±c hÃ nh xá»­ lÃ½ truy váº¥n phÃ¢n tÃ¡n trong JavaFX

ğŸ¯ Káº¿t quáº£ Ä‘áº¡t Ä‘Æ°á»£c:
   - 3 SQL Server instances hoáº¡t Ä‘á»™ng Ä‘á»“ng bá»™
   - Dá»¯ liá»‡u Ä‘Æ°á»£c phÃ¢n máº£nh há»£p lÃ½
   - 10 cÃ¢u query xá»­ lÃ½ phÃ¢n tÃ¡n thÃ nh cÃ´ng
   - Giao diá»‡n JavaFX káº¿t ná»‘i mÆ°á»£t mÃ  vá»›i cáº£ 3 DB

ğŸ“§ LiÃªn há»‡: [ThÃ´ng tin sinh viÃªn/nhÃ³m]
ğŸ“… NgÃ y: 18/11/2025

================================================================================
Háº¾T
================================================================================
